<!--
Copyright (c) 2019-2020, Amazon.com, Inc. or its affiliates. All rights reserved.
See LICENSE.txt for license information

Static pre-configured topology for `p5de.48xlarge` platform type.
This has 2 groups of PCIe hierarchy under each socket. Each group has
2 GPUs and 4 NIC behind a PCIe switch.

This topology is ingested into NCCL using `NCCL_TOPO_FILE` environment
variable when the underlying system is detected as `p5de.48xlarge`.

Note: The PCI IDs of GPUs and NICs needs to match the device IDs on the
virtual machine.
-->
<system version="1">
  <cpu numaid="0" affinity="00000000,00000000,00000000,00000000,0000ffff,ffffffff" arch="x86_64" vendor="GenuineIntel" familyid="6" modelid="143">  <!-- Reserving the middle 96 cores for UCCL plugin (affinity bitmask reads from right) -->
    <pci busid="ffff:ff:01.0" class="0x060400" vendor="0xffff" device="0xffff" subsystem_vendor="0xffff" subsystem_device="0xffff" link_speed="32 GT/s" link_width="16">  <!-- Switch 0 begins -->
        <pci busid="0000:59:00.0" class="0x030200" vendor="0x10de" device="0x2335" subsystem_vendor="0x10de" subsystem_device="0x18be" link_speed="32 GT/s" link_width="16"/> <!-- GPU 0 -->
        <pci busid="0000:5a:00.0" class="0x030200" vendor="0x10de" device="0x2335" subsystem_vendor="0x10de" subsystem_device="0x18be" link_speed="32 GT/s" link_width="16"/> <!-- GPU 1 -->
        <pci busid="0000:55:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 0 -->
        <pci busid="0000:56:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 1 -->
        <pci busid="0000:57:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 2 -->
        <pci busid="0000:58:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 3 -->
    </pci> <!-- Switch 0 ends -->
    <pci busid="ffff:ff:02.0" class="0x060400" vendor="0xffff" device="0xffff" subsystem_vendor="0xffff" subsystem_device="0xffff" link_speed="32 GT/s" link_width="16">  <!-- Switch 1 begins -->
        <pci busid="0000:72:00.0" class="0x030200" vendor="0x10de" device="0x2335" subsystem_vendor="0x10de" subsystem_device="0x18be" link_speed="32 GT/s" link_width="16"/> <!-- GPU 2 -->
        <pci busid="0000:73:00.0" class="0x030200" vendor="0x10de" device="0x2335" subsystem_vendor="0x10de" subsystem_device="0x18be" link_speed="32 GT/s" link_width="16"/> <!-- GPU 3 -->
        <pci busid="0000:6e:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 4 -->
        <pci busid="0000:6f:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 5 -->
        <pci busid="0000:70:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 6 -->
        <pci busid="0000:71:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 7 -->
    </pci> <!-- Switch 1 ends -->
  </cpu>
  <cpu numaid="1" affinity="ffffffff,ffff0000,00000000,00000000,00000000,00000000" arch="x86_64" vendor="GenuineIntel" familyid="6" modelid="143">  <!-- Reserving the middle 96 cores for UCCL plugin -->
    <pci busid="ffff:ff:03.0" class="0x060400" vendor="0xffff" device="0xffff" subsystem_vendor="0xffff" subsystem_device="0xffff" link_speed="32 GT/s" link_width="16">  <!-- Switch 2 begins -->
        <pci busid="0000:8b:00.0" class="0x030200" vendor="0x10de" device="0x2335" subsystem_vendor="0x10de" subsystem_device="0x18be" link_speed="32 GT/s" link_width="16"/> <!-- GPU 4 -->
        <pci busid="0000:8c:00.0" class="0x030200" vendor="0x10de" device="0x2335" subsystem_vendor="0x10de" subsystem_device="0x18be" link_speed="32 GT/s" link_width="16"/> <!-- GPU 5 -->
        <pci busid="0000:87:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 8 -->
        <pci busid="0000:88:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 9 -->
        <pci busid="0000:89:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 10 -->
        <pci busid="0000:8a:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 11 -->
    </pci> <!-- Switch 2 ends -->
    <pci busid="ffff:ff:04.0" class="0x060400" vendor="0xffff" device="0xffff" subsystem_vendor="0xffff" subsystem_device="0xffff" link_speed="32 GT/s" link_width="16">  <!-- Switch 3 begins -->
        <pci busid="0000:a4:00.0" class="0x030200" vendor="0x10de" device="0x2335" subsystem_vendor="0x10de" subsystem_device="0x18be" link_speed="32 GT/s" link_width="16"/> <!-- GPU 6 -->
        <pci busid="0000:a5:00.0" class="0x030200" vendor="0x10de" device="0x2335" subsystem_vendor="0x10de" subsystem_device="0x18be" link_speed="32 GT/s" link_width="16"/> <!-- GPU 7 -->
        <pci busid="0000:a0:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 12 -->
        <pci busid="0000:a1:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 13 -->
        <pci busid="0000:a2:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 14 -->
        <pci busid="0000:a3:00.0" class="0x020000" vendor="0x1d0f" device="0xefa2" subsystem_vendor="0x1d0f" subsystem_device="0xefa2" link_speed="32 GT/s" link_width="8"/> <!-- NIC 15 -->
    </pci> <!-- Switch 3 ends -->
  </cpu>
</system>